#include <msp430.h> 

#define CPU_F          ((double)1000000)
#define delay_ms(x)    _delay_cycles((long)(CPU_F*(double)x/1000.0))

#define CS_1 P6OUT |= BIT1
#define CS_0 P6OUT &= ~BIT1
#define CLK_1 P6OUT |= BIT2
#define CLK_0 P6OUT &= ~BIT2
#define DIN_1 P6OUT |= BIT0
#define DIN_0 P6OUT &= ~BIT0

#define MAX_NOTE 800             // 音频文件长度
#define SPEED 15                 // 十六分音符时间（8ms*15）

unsigned char character[100][2][8] = {  {{0x00, 0x00, 0x00,  0x00,  0x00,  0x00, 0x00, 0x00},
                                         {0x00, 0x00, 0x00,  0x00,  0x00,  0x00, 0x00, 0x00},},
                                        // A
                                        {{0b00011110,
                                          0b00100010,
                                          0b00100010,
                                          0b00111110,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111110,
                                          0b00001001,
                                          0b00001001,
                                          0b00001001,
                                          0b01111111,
                                          0b00000000,
                                         },
                                        },
                                        // B
                                        {{0b00111100,
                                          0b00100010,
                                          0b00100010,
                                          0b00111100,
                                          0b00100010,
                                          0b00100010,
                                          0b00111100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111111,
                                          0b01001001,
                                          0b01001001,
                                          0b01001001,
                                          0b00110110,
                                          0b00000000,
                                         },
                                        },
                                        // C
                                        {{0b00011100,
                                          0b00100010,
                                          0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00111110,
                                          0b01000001,
                                          0b01000001,
                                          0b01000001,
                                          0b00100010,
                                          0b00000000,
                                         },
                                        },
                                        // D
                                        {{0b00111100,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00111100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111111,
                                          0b01000001,
                                          0b01000001,
                                          0b01000001,
                                          0b00111110,
                                          0b00000000,
                                         },
                                        },
                                        // E
                                        {{0b00111110,
                                          0b00100000,
                                          0b00100000,
                                          0b00111100,
                                          0b00100000,
                                          0b00100000,
                                          0b00111110,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111111,
                                          0b01001001,
                                          0b01001001,
                                          0b01001001,
                                          0b01000001,
                                          0b00000000,
                                         },
                                        },
                                        // F
                                        {{0b00111110,
                                          0b00100000,
                                          0b00100000,
                                          0b00111100,
                                          0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111111,
                                          0b00001001,
                                          0b00001001,
                                          0b00001001,
                                          0b00000001,
                                          0b00000000,
                                         },
                                        },
                                        // G
                                        {{0b00011100,
                                          0b00100010,
                                          0b00100000,
                                          0b00100000,
                                          0b00100110,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00111110,
                                          0b01000001,
                                          0b01000001,
                                          0b01010001,
                                          0b00110010,
                                          0b00000000,
                                         },
                                        },
                                        // H
                                        {{0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00111110,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111111,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b01111111,
                                          0b00000000,
                                         },
                                        },
                                        // I
                                        {{0b00011100,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b01000001,
                                          0b01111111,
                                          0b01000001,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // J
                                        {{0b00000110,
                                          0b00000010,
                                          0b00000010,
                                          0b00000010,
                                          0b00100010,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00110000,
                                          0b01000000,
                                          0b01000000,
                                          0b01000001,
                                          0b00111111,
                                          0b00000000,
                                         },
                                        },
                                        // K
                                        {{0b00100010,
                                          0b00100100,
                                          0b00101000,
                                          0b00110000,
                                          0b00101000,
                                          0b00100100,
                                          0b00100010,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111111,
                                          0b00001000,
                                          0b00010100,
                                          0b00100010,
                                          0b01000001,
                                          0b00000000,
                                         },
                                        },
                                        // L
                                        {{0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00111110,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111111,
                                          0b01000000,
                                          0b01000000,
                                          0b01000000,
                                          0b01000000,
                                          0b00000000,
                                         },
                                        },
                                        // M
                                        {{0b00100010,
                                          0b00110110,
                                          0b00101010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111111,
                                          0b00000010,
                                          0b00000100,
                                          0b00000010,
                                          0b01111111,
                                          0b00000000,
                                         },
                                        },
                                        // N
                                        {{0b00100010,
                                          0b00100010,
                                          0b00110010,
                                          0b00101010,
                                          0b00100110,
                                          0b00100010,
                                          0b00100010,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111111,
                                          0b00000100,
                                          0b00001000,
                                          0b00010000,
                                          0b01111111,
                                          0b00000000,
                                         },
                                        },
                                        // O
                                        {{0b00011100,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00111110,
                                          0b01000001,
                                          0b01000001,
                                          0b01000001,
                                          0b00111110,
                                          0b00000000,
                                         },
                                        },
                                        // P
                                        {{0b00111100,
                                          0b00100010,
                                          0b00100010,
                                          0b00111100,
                                          0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111111,
                                          0b00001001,
                                          0b00001001,
                                          0b00001001,
                                          0b00000110,
                                          0b00000000,
                                         },
                                        },
                                        // Q
                                        {{0b00011100,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00101010,
                                          0b00100100,
                                          0b00011010,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00111110,
                                          0b01000001,
                                          0b01010001,
                                          0b00100001,
                                          0b01011110,
                                          0b00000000,
                                         },
                                        },
                                        // R
                                        {{0b00111100,
                                          0b00100010,
                                          0b00100010,
                                          0b00111100,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111111,
                                          0b00001001,
                                          0b00001001,
                                          0b00001001,
                                          0b01110110,
                                          0b00000000,
                                         },
                                        },
                                        // S
                                        {{0b00011100,
                                          0b00100010,
                                          0b00100000,
                                          0b00011100,
                                          0b00000010,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00100110,
                                          0b01001001,
                                          0b01001001,
                                          0b01001001,
                                          0b00110010,
                                          0b00000000,
                                         },
                                        },
                                        // T
                                        {{0b00111110,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000001,
                                          0b00000001,
                                          0b01111111,
                                          0b00000001,
                                          0b00000001,
                                          0b00000000,
                                         },
                                        },
                                        // U
                                        {{0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00111111,
                                          0b01000000,
                                          0b01000000,
                                          0b01000000,
                                          0b00111111,
                                          0b00000000,
                                         },
                                        },
                                        // V
                                        {{0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00010100,
                                          0b00001000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00011111,
                                          0b00100000,
                                          0b01000000,
                                          0b00100000,
                                          0b00011111,
                                          0b00000000,
                                         },
                                        },
                                        // W
                                        {{0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00101010,
                                          0b00101010,
                                          0b00010100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00111111,
                                          0b01000000,
                                          0b00110000,
                                          0b01000000,
                                          0b00111111,
                                          0b00000000,
                                         },
                                        },
                                        // X
                                        {{0b00100010,
                                          0b00100010,
                                          0b00010100,
                                          0b00001000,
                                          0b00010100,
                                          0b00100010,
                                          0b00100010,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01100011,
                                          0b00010100,
                                          0b00001000,
                                          0b00010100,
                                          0b01100011,
                                          0b00000000,
                                         },
                                        },
                                        // Y
                                        {{0b00100010,
                                          0b00100010,
                                          0b00010100,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000011,
                                          0b00000100,
                                          0b01111000,
                                          0b00000100,
                                          0b00000011,
                                          0b00000000,
                                         },
                                        },
                                        // Z
                                        {{0b00111110,
                                          0b00000010,
                                          0b00000100,
                                          0b00001000,
                                          0b00010000,
                                          0b00100000,
                                          0b00111110,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01100001,
                                          0b01010001,
                                          0b01001001,
                                          0b01000101,
                                          0b01000011,
                                          0b00000000,
                                         },
                                        },

                                        // a
                                        {{0b00000000,
                                          0b00000000,
                                          0b00011000,
                                          0b00000100,
                                          0b00011100,
                                          0b00100100,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00100000,
                                          0b01010100,
                                          0b01010100,
                                          0b01111000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // b
                                        {{0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00111000,
                                          0b00100100,
                                          0b00100100,
                                          0b00111000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111111,
                                          0b01001000,
                                          0b01001000,
                                          0b00110000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // c
                                        {{0b00000000,
                                          0b00000000,
                                          0b00011000,
                                          0b00100100,
                                          0b00100000,
                                          0b00100100,
                                          0b00011000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00111000,
                                          0b01000100,
                                          0b01000100,
                                          0b00101000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // d
                                        {{0b00000100,
                                          0b00000100,
                                          0b00000100,
                                          0b00011100,
                                          0b00100100,
                                          0b00100100,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00110000,
                                          0b01001000,
                                          0b01001000,
                                          0b01111111,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // e
                                        {{0b00000000,
                                          0b00000000,
                                          0b00011000,
                                          0b00100100,
                                          0b00111100,
                                          0b00100000,
                                          0b00011000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00111000,
                                          0b01010100,
                                          0b01010100,
                                          0b00011000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // f
                                        {{0b00001100,
                                          0b00010000,
                                          0b00011100,
                                          0b00010000,
                                          0b00010000,
                                          0b00010000,
                                          0b00010000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b01111110,
                                          0b00000101,
                                          0b00000101,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // g
                                        {{0b00000000,
                                          0b00000000,
                                          0b00011100,
                                          0b00100100,
                                          0b00100100,
                                          0b00011100,
                                          0b00000100,
                                          0b00011000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00011000,
                                          0b10100100,
                                          0b10100100,
                                          0b01111100,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // h
                                        {{0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00111000,
                                          0b00100100,
                                          0b00100100,
                                          0b00100100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111111,
                                          0b00001000,
                                          0b00001000,
                                          0b01110000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // i
                                        {{0b00001000,
                                          0b00000000,
                                          0b00000000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b01111001,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // j
                                        {{0b00001000,
                                          0b00000000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00010000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b10000000,
                                          0b01111101,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // k
                                        {{0b00100000,
                                          0b00100000,
                                          0b00100100,
                                          0b00101000,
                                          0b00110000,
                                          0b00101000,
                                          0b00100100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111111,
                                          0b00010000,
                                          0b00101000,
                                          0b01000100,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // l
                                        {{0b00010000,
                                          0b00010000,
                                          0b00010000,
                                          0b00010000,
                                          0b00010000,
                                          0b00010000,
                                          0b00001000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00111111,
                                          0b01000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // m
                                        {{0b00000000,
                                          0b00000000,
                                          0b00111100,
                                          0b00101010,
                                          0b00101010,
                                          0b00101010,
                                          0b00101010,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111100,
                                          0b00000100,
                                          0b01111100,
                                          0b00000100,
                                          0b01111000,
                                          0b00000000,
                                         },
                                        },
                                        // n
                                        {{0b00000000,
                                          0b00000000,
                                          0b00111000,
                                          0b00100100,
                                          0b00100100,
                                          0b00100100,
                                          0b00100100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111100,
                                          0b00000100,
                                          0b00000100,
                                          0b01111000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // o
                                        {{0b00000000,
                                          0b00000000,
                                          0b00011000,
                                          0b00100100,
                                          0b00100100,
                                          0b00100100,
                                          0b00011000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00111000,
                                          0b01000100,
                                          0b01000100,
                                          0b00111000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // p
                                        {{0b00000000,
                                          0b00000000,
                                          0b00011000,
                                          0b00100100,
                                          0b00100100,
                                          0b00111000,
                                          0b00100000,
                                          0b00100000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b11111000,
                                          0b00100100,
                                          0b00100100,
                                          0b00011000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // q
                                        {{0b00000000,
                                          0b00000000,
                                          0b00011000,
                                          0b00100100,
                                          0b00100100,
                                          0b00011100,
                                          0b00000100,
                                          0b00000100,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00011000,
                                          0b00100100,
                                          0b00100100,
                                          0b11111000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // r
                                        {{0b00000000,
                                          0b00000000,
                                          0b00101100,
                                          0b00110000,
                                          0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01111100,
                                          0b00001000,
                                          0b00000100,
                                          0b00000100,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // s
                                        {{0b00000000,
                                          0b00000000,
                                          0b00011100,
                                          0b00100000,
                                          0b00011000,
                                          0b00000100,
                                          0b00111000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01001000,
                                          0b01010100,
                                          0b01010100,
                                          0b00100100,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // t
                                        {{0b00010000,
                                          0b00010000,
                                          0b00111100,
                                          0b00010000,
                                          0b00010000,
                                          0b00010000,
                                          0b00001100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000100,
                                          0b00111111,
                                          0b01000100,
                                          0b01000100,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // u
                                        {{0b00000000,
                                          0b00000000,
                                          0b00100100,
                                          0b00100100,
                                          0b00100100,
                                          0b00100100,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00111100,
                                          0b01000000,
                                          0b01000000,
                                          0b01111100,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // v
                                        {{0b00000000,
                                          0b00000000,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00010100,
                                          0b00001000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00011100,
                                          0b00100000,
                                          0b01000000,
                                          0b00100000,
                                          0b00011100,
                                          0b00000000,
                                         },
                                        },
                                        // w
                                        {{0b00000000,
                                          0b00000000,
                                          0b00100010,
                                          0b00100010,
                                          0b00101010,
                                          0b00101010,
                                          0b00010100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00111100,
                                          0b01000000,
                                          0b00110000,
                                          0b01000000,
                                          0b00111100,
                                          0b00000000,
                                         },
                                        },
                                        // x
                                        {{0b00000000,
                                          0b00000000,
                                          0b00100100,
                                          0b00100100,
                                          0b00011000,
                                          0b00100100,
                                          0b00100100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01101100,
                                          0b00010000,
                                          0b00010000,
                                          0b01101100,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // y
                                        {{0b00000000,
                                          0b00000000,
                                          0b00100100,
                                          0b00100100,
                                          0b00100100,
                                          0b00011100,
                                          0b00000100,
                                          0b00011000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00011100,
                                          0b10100000,
                                          0b10100000,
                                          0b01111100,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // z
                                        {{0b00000000,
                                          0b00000000,
                                          0b00111100,
                                          0b00000100,
                                          0b00011000,
                                          0b00100000,
                                          0b00111100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01100100,
                                          0b01010100,
                                          0b01010100,
                                          0b01001100,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },

                                        // 0
                                        {{0b00011100,
                                          0b00100010,
                                          0b00100110,
                                          0b00101010,
                                          0b00110010,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00111110,
                                          0b01010001,
                                          0b01001001,
                                          0b01000101,
                                          0b00111110,
                                          0b00000000,
                                         },
                                        },
                                        // 1
                                        {{0b00001000,
                                          0b00011000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b01000010,
                                          0b01111111,
                                          0b01000000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // 2
                                        {{0b00011100,
                                          0b00100010,
                                          0b00000010,
                                          0b00001100,
                                          0b00010000,
                                          0b00100000,
                                          0b00111110,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b01100010,
                                          0b01010001,
                                          0b01001001,
                                          0b01001001,
                                          0b01000110,
                                          0b00000000,
                                         },
                                        },
                                        // 3
                                        {{0b00011100,
                                          0b00100010,
                                          0b00000010,
                                          0b00001100,
                                          0b00000010,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00100010,
                                          0b01000001,
                                          0b01001001,
                                          0b01001001,
                                          0b00110110,
                                          0b00000000,
                                         },
                                        },
                                        // 4
                                        {{0b00000110,
                                          0b00001010,
                                          0b00010010,
                                          0b00100010,
                                          0b00111110,
                                          0b00000010,
                                          0b00000010,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00011000,
                                          0b00010100,
                                          0b00010010,
                                          0b00010001,
                                          0b01111111,
                                          0b00000000,
                                         },
                                        },
                                        // 5
                                        {{0b00111110,
                                          0b00100000,
                                          0b00111100,
                                          0b00000010,
                                          0b00000010,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00100111,
                                          0b01000101,
                                          0b01000101,
                                          0b01000101,
                                          0b00111001,
                                          0b00000000,
                                         },
                                        },
                                        // 6
                                        {{0b00011100,
                                          0b00100010,
                                          0b00100000,
                                          0b00111100,
                                          0b00100010,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00111110,
                                          0b01001001,
                                          0b01001001,
                                          0b01001001,
                                          0b00110010,
                                          0b00000000,
                                         },
                                        },
                                        // 7
                                        {{0b00111110,
                                          0b00000010,
                                          0b00000100,
                                          0b00001000,
                                          0b00010000,
                                          0b00010000,
                                          0b00010000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000001,
                                          0b01110001,
                                          0b00001001,
                                          0b00000101,
                                          0b00000011,
                                          0b00000000,
                                         },
                                        },
                                        // 8
                                        {{0b00011100,
                                          0b00100010,
                                          0b00100010,
                                          0b00011100,
                                          0b00100010,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00110110,
                                          0b01001001,
                                          0b01001001,
                                          0b01001001,
                                          0b00110110,
                                          0b00000000,
                                         },
                                        },
                                        // 9
                                        {{0b00011100,
                                          0b00100010,
                                          0b00100010,
                                          0b00011110,
                                          0b00000010,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00100110,
                                          0b01001001,
                                          0b01001001,
                                          0b01001001,
                                          0b00111110,
                                          0b00000000,
                                         },
                                        },
                                        // :
                                        {{0b00000000,
                                          0b00000000,
                                          0b00001000,
                                          0b00000000,
                                          0b00000000,
                                          0b00001000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00100100,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // ,
                                        {{0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00001000,
                                          0b00010000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b01000000,
                                          0b00100000,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // .
                                        {{0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00001000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b01000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // (
                                        {{0b00001000,
                                          0b00010000,
                                          0b00010000,
                                          0b00010000,
                                          0b00010000,
                                          0b00010000,
                                          0b00001000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00111110,
                                          0b01000001,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // )
                                        {{0b00010000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00010000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b01000001,
                                          0b00111110,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },
                                        // ?
                                        {{0b00011100,
                                          0b00100010,
                                          0b00000010,
                                          0b00000100,
                                          0b00001000,
                                          0b00000000,
                                          0b00001000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000010,
                                          0b00000001,
                                          0b01010001,
                                          0b00001001,
                                          0b00000110,
                                          0b00000000,
                                         },
                                        },
                                        // -
                                        {{0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00011100,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00010000,
                                          0b00010000,
                                          0b00010000,
                                          0b00000000,
                                          0b00000000,
                                         },
                                        },

                                        // 哈
                                        {{0b00011110,
                                          0b00100010,
                                          0b00100010,
                                          0b00111110,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00000000,
                                         },
                                         {0b00111000,
                                          0b00101000,
                                          0b00111000,
                                          0b00000100,
                                          0b11101010,
                                          0b10101001,
                                          0b10101010,
                                          0b11100100,
                                         },
                                        },
                                        // 尔
                                        {{0b00111100,
                                          0b00100010,
                                          0b00100010,
                                          0b00111100,
                                          0b00100010,
                                          0b00100010,
                                          0b00111100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00100100,
                                          0b00010010,
                                          0b01000011,
                                          0b11111110,
                                          0b00000010,
                                          0b00010110,
                                          0b00100010,
                                         },
                                        },
                                        // 滨
                                        {{0b00011100,
                                          0b00100010,
                                          0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b11000101,
                                          0b00101010,
                                          0b00000000,
                                          0b01000110,
                                          0b11111010,
                                          0b01010111,
                                          0b11110010,
                                          0b01000110,
                                         },
                                        },
                                        // 工
                                        {{0b00111100,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00111100,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b10000000,
                                          0b10000001,
                                          0b10000001,
                                          0b11111111,
                                          0b10000001,
                                          0b10000001,
                                          0b10000000,
                                         },
                                        },
                                        // 业
                                        {{0b00111110,
                                          0b00100000,
                                          0b00100000,
                                          0b00111100,
                                          0b00100000,
                                          0b00100000,
                                          0b00111110,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b10011000,
                                          0b10100000,
                                          0b11111111,
                                          0b10000000,
                                          0b11111111,
                                          0b10100000,
                                          0b10011000,
                                         },
                                        },
                                        // 大
                                        {{0b00111110,
                                          0b00100000,
                                          0b00100000,
                                          0b00111100,
                                          0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00000000,
                                         },
                                         {0b10001000,
                                          0b01001000,
                                          0b00101000,
                                          0b00011111,
                                          0b00101000,
                                          0b01001000,
                                          0b10001000,
                                          0b00000000,
                                         },
                                        },
                                        // 学
                                        {{0b00011100,
                                          0b00100010,
                                          0b00100000,
                                          0b00100000,
                                          0b00100110,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00001100,
                                          0b00100010,
                                          0b00101011,
                                          0b10101010,
                                          0b11111011,
                                          0b00101010,
                                          0b00100011,
                                          0b00001100,
                                         },
                                        },
                                        // 规
                                        {{0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00111110,
                                          0b00000000,
                                         },
                                         {0b10010100,
                                          0b01111111,
                                          0b10010100,
                                          0b10011111,
                                          0b01000001,
                                          0b10111111,
                                          0b10000001,
                                          0b11011111,
                                         },
                                        },
                                        // 严
                                        {{0b00100010,
                                          0b00100010,
                                          0b00110010,
                                          0b00101010,
                                          0b00100110,
                                          0b00100010,
                                          0b00100010,
                                          0b00000000,
                                         },
                                         {0b10000000,
                                          0b01110101,
                                          0b00011001,
                                          0b00011111,
                                          0b00010001,
                                          0b00011111,
                                          0b00011001,
                                          0b00010101,
                                         },
                                        },
                                        // 格
                                        {{0b00100010,
                                          0b00100010,
                                          0b00110010,
                                          0b00101010,
                                          0b00100110,
                                          0b00100010,
                                          0b00100010,
                                          0b00000000,
                                         },
                                         {0b00110100,
                                          0b11111111,
                                          0b00110100,
                                          0b00010010,
                                          0b11110101,
                                          0b10101010,
                                          0b10111010,
                                          0b11010110,
                                         },
                                        },
                                        // 功
                                        {{0b00011100,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00100100,
                                          0b00111100,
                                          0b00100100,
                                          0b10000000,
                                          0b01000100,
                                          0b00111111,
                                          0b10000100,
                                          0b11111100,
                                         },
                                        },
                                        // 夫
                                        {{0b00111100,
                                          0b00100010,
                                          0b00100010,
                                          0b00111100,
                                          0b00100000,
                                          0b00100000,
                                          0b00100000,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b10010000,
                                          0b10010100,
                                          0b01010100,
                                          0b00111111,
                                          0b01010100,
                                          0b10010100,
                                          0b10010000,
                                         },
                                        },
                                        // 到
                                        {{0b00011100,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00101010,
                                          0b00100100,
                                          0b00011010,
                                          0b00000000,
                                         },
                                         {0b10010101,
                                          0b11111111,
                                          0b10010101,
                                          0b10010101,
                                          0b00000000,
                                          0b00011100,
                                          0b10000000,
                                          0b11111111,
                                         },
                                        },
                                        // 家
                                        {{0b00111100,
                                          0b00100010,
                                          0b00100010,
                                          0b00111100,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00000000,
                                         },
                                         {0b00001110,
                                          0b10100010,
                                          0b01010110,
                                          0b10101111,
                                          0b11111110,
                                          0b00100110,
                                          0b01010010,
                                          0b10001110,
                                         },
                                        },
                                        // 百
                                        {{0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00111110,
                                          0b00100010,
                                          0b00100010,
                                          0b00100010,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b11111001,
                                          0b10101001,
                                          0b10101101,
                                          0b10101011,
                                          0b10101001,
                                          0b11111001,
                                          0b00000000,
                                         },
                                        },
                                        // 年
                                        {{0b00011100,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00001000,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00100100,
                                          0b00110010,
                                          0b00101011,
                                          0b00101010,
                                          0b11111110,
                                          0b00101010,
                                          0b00101010,
                                          0b00100000,
                                         },
                                        },
                                        // 校
                                        {{0b00000110,
                                          0b00000010,
                                          0b00000010,
                                          0b00000010,
                                          0b00100010,
                                          0b00100010,
                                          0b00011100,
                                          0b00000000,
                                         },
                                         {0b00110100,
                                          0b11111111,
                                          0b00010100,
                                          0b10001010,
                                          0b01010110,
                                          0b00100011,
                                          0b01010110,
                                          0b10001010,
                                          },
                                        },
                                        // 庆
                                        {{0b00100010,
                                          0b00100100,
                                          0b00101000,
                                          0b00110000,
                                          0b00101000,
                                          0b00100100,
                                          0b00100010,
                                          0b00000000,
                                         },
                                         {0b10000000,
                                          0b01000000,
                                          0b00111110,
                                          0b10010010,
                                          0b01010011,
                                          0b00111110,
                                          0b01010010,
                                          0b10010010,
                                         },
                                        },


                                        //
                                        {{0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00011000,
                                          0b00011000,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,}//心1
                                        },
                                        //
                                        {{0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00001000,
                                          0b00011100,
                                          0b00111000,
                                          0b00111000,
                                          0b00011100,
                                          0b00001000,
                                          0b00000000,}//心2
                                        },
                                        //
                                        {{0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00000000,
                                         },
                                         {0b00001000,
                                          0b00011100,
                                          0b00111110,
                                          0b01111100,
                                          0b01111100,
                                          0b00111110,
                                          0b00011100,
                                          0b00001000,}//心3
                                        },
                                        //
                                        {{0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00000000,
                                         },
                                         {0b00000000,
                                          0b00001000,
                                          0b00011100,
                                          0b00111000,
                                          0b00111000,
                                          0b00011100,
                                          0b00001000,
                                          0b00000000,}//心2
                                        },

                                        //
                                        {{0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00000000,
                                         },
                                         {
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                          0b00011000,
                                          0b00011000,
                                          0b00000000,
                                          0b00000000,
                                          0b00000000,
                                        }//礼花1
                                        },
                                        //
                                        {{0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00000000,
                                         },
                                         {
                                           0b00000000,
                                           0b00000000,
                                           0b00101100,
                                           0b00111000,
                                           0b00011100,
                                           0b00110100,
                                           0b00000000,
                                           0b00000000,
                                         }//礼花2
                                        },
                                        //
                                        {{0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00000000,
                                         },
                                         {
                                           0b00000000,
                                           0b01001010,
                                           0b00101100,
                                           0b01111000,
                                           0b00011110,
                                           0b00110100,
                                           0b01010010,
                                           0b00000000,
                                         }//礼花3
                                        },
                                        //
                                        {{0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00000000,
                                         },
                                         {
                                           0b10001001,
                                           0b01001010,
                                           0b00101100,
                                           0b11111000,
                                           0b00011111,
                                           0b00110100,
                                           0b01010010,
                                           0b10010001,
                                         }//礼花4
                                        },
                                        //
                                        {{0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00000000,
                                         },
                                         {
                                           0b00000000,
                                           0b01001010,
                                           0b00101100,
                                           0b01111000,
                                           0b00011110,
                                           0b00110100,
                                           0b01010010,
                                           0b00000000,
                                         }//礼花3
                                        },
                                        //
                                        {{0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00,
                                          0b00000000,
                                         },
                                         {
                                           0b00000000,
                                           0b00000000,
                                           0b00101100,
                                           0b00111000,
                                           0b00011100,
                                           0b00110100,
                                           0b00000000,
                                           0b00000000,
                                         }//礼花2
                                        },
                                       };

// int song[MAX_NOTE] = {11, 12, 13, 14, 15, 16, 17, 0, 0, 0, 21, 22, 23, 24, 25, 26, 27, 0, 0, 0, 31, 32, 33, 34, 35, 36, 37,};
int song[MAX_NOTE] = {25, 25, 25, 25, 25, 0,  24, 24, 23, 23, 23, 0,  21, 21, 21, 0,
                      25, 25, 25, 25, 25, 0,  24, 24, 23, 23, 23, 0,  21, 21, 21, 0,
                      23, 23, 0,  23, 23, 23, 24, 24, 25, 25, 25, 25, 25, 0,  25, 25,
                      26, 26, 26, 0,  26, 26, 0,  25, 24, 24, 0,  24, 23, 23, 23, 23,
                      22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 0,  0,
                      25, 25, 25, 25, 25, 0,  24, 24, 23, 23, 23, 0,  21, 21, 21, 0,
                      25, 25, 25, 25, 25, 0,  24, 24, 23, 23, 23, 0,  21, 21, 21, 0,
                      24, 24, 0,  24, 24, 24, 25, 25, 26, 26, 26, 26, 26, 0,  26, 26,
                      25, 25, 25, 0,  21, 21, 0,  21, 22, 22, 0,  22, 23, 23, 23, 23,
                      21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 0,  0,
                      23, 23, 23, 23, 26, 26, 26, 23, 23, 23, 23, 23, 21, 21, 21, 21,
                      16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 0,  23, 23, 23, 23,
                      26, 26, 26, 26, 23, 23, 23, 23, 25, 25, 26, 26, 27, 27, 25, 25,
                      23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 0,  0,
                      23, 23, 23, 23, 26, 26, 26, 26, 23, 23, 23, 23, 21, 21, 21, 21,
                      22, 22, 23, 23, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 0,  0,
                      22, 22, 22, 22, 21, 21, 21, 16, 21, 21, 21, 21, 22, 22, 22, 22,
                      23, 23, 23, 0,  23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 0,  0,
                      23, 23, 23, 23, 26, 26, 26, 26, 23, 23, 23, 22, 21, 21, 17, 17,
                      16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 0,  0,  23, 23, 23, 23,
                      26, 26, 26, 26, 23, 23, 23, 23, 25, 25, 26, 26, 27, 27, 25, 25,
                      23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 0,  0,
                      23, 23, 23, 23, 26, 26, 26, 26, 23, 23, 23, 23, 21, 21, 21, 21,
                      25, 25, 25, 25, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 0,  0,
                      25, 25, 25, 25, 22, 22, 22, 0,  22, 22, 22, 22, 25, 25, 26, 26,
                      27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 0,  0,
                      31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 0,  26, 26, 26, 24, 24,
                      25, 25, 25, 0,  25, 25, 25, 0,  0,  0 , 0,  0,  0,  0,  0,  0,
                      23, 23, 23, 0,  24, 24, 24, 0,  25, 25, 25, 0,  25, 25, 25, 0,
                      26, 26, 26, 0,  25, 25, 25, 0,  24, 24, 24, 0,  23, 23, 23, 0,
                      22, 22, 22, 0,  23, 23, 23, 0,  24, 24, 24, 0,  25, 25, 25, 0,
                      26, 26, 26, 0 , 27, 27, 27, 0,  26, 26, 26, 0,  25, 25, 25, 0,
                      31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 0,  26, 26, 26, 24, 24,
                      25, 25, 25, 0,  25, 25, 25, 0,  0,  0 , 0,  0,  0,  0,  0,  0,
                      23, 23, 0,  23, 23, 23, 24, 0,  25, 25, 25, 0,  25, 25, 25, 0,
                      24, 24, 0,  24, 24, 24, 25, 0,  26, 26, 26, 0,  26, 26, 26, 0,
                      25, 25, 0,  25, 25, 25, 23, 0,  25, 25, 25, 25, 26, 26, 26, 26,
                      27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 0,  0,  0,  0,
                      27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 0,  0,  25, 25, 25, 0,
                      25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 0,  0,
                      31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31,};
int pos = 0;                   // 记录歌曲播放进度
char flag = 0;                 // 是否播放歌曲
int speed_ctrl = 0;            // 控制播放速度

char display_flag_a = 0;       // 是否显示字符画A
char display_flag_b = 0;       // 是否显示字符画B


void write_byte(unsigned char data) {
    char i;
    for (i = 8; i > 0; i--) {
        CLK_0;
        if (0x80 & data) {
            DIN_1;
        } else {
            DIN_0;
        }
        data = data << 1;
        CLK_1;
    }
}


void write(unsigned char addr1, unsigned char data1, unsigned char addr2, unsigned char data2,
           unsigned char addr3, unsigned char data3, unsigned char addr4, unsigned char data4)
{
     CS_0;
     write_byte(addr1);              //写入地址，即数码管编号
     write_byte(data1);              //写入数据，即数码管显示数字
     write_byte(addr2);              //写入地址，即数码管编号
     write_byte(data2);              //写入数据，即数码管显示数字
     write_byte(addr3);              //写入地址，即数码管编号
     write_byte(data3);              //写入数据，即数码管显示数字
     write_byte(addr4);              //写入地址，即数码管编号
     write_byte(data4);              //写入数据，即数码管显示数字
     CS_1;
}

void init1(void)
{
    P6DIR |= BIT0 + BIT1 + BIT2;
    write(0x09, 0x00, 0x09, 0x00, 0x09, 0x00, 0x09, 0x00);       // 译码方式：BCD码
    write(0x0A, 0x03, 0x0A, 0x03, 0x0A, 0x03, 0x0A, 0x03);       // 亮度
    write(0x0B, 0x07, 0x0B, 0x07, 0x0B, 0x07, 0x0B, 0x07);       // 扫描界限；8个数码管显示
    write(0x0C, 0x01, 0x0C, 0x01, 0x0C, 0x01, 0x0C, 0x01);       // 掉电模式：0，普通模式：1
    write(0x0F, 0x01, 0x0F, 0x01, 0x0F, 0x01, 0x0F, 0x01);       // 显示测试：1；
  //delay_ms(1000);
    write(0x0F, 0x00, 0x0F, 0x00, 0x0F, 0x00, 0x0F, 0x00);       // 测试结束，正常显示：0
}

unsigned int char2bit(char m) {
    unsigned int n;
    if (m == '\0') {
        return 99;                                               // 结束标志
    }
    if (65 <= m && m <= 90) {                                    // A-Z
        n = m - 64;
    } else if (97 <= m && m <= 122) {                            // a-z
        n = m - 96 + 26;
    } else if (48 <= m && m <= 64) {                             // 特殊字符（汉字和标点）
        n =  m - 47 + 26 + 26;
        // :;<=>?@
        // :,.()?-
    } else if (33 <= m && m <= 46) {
        n = m - 32 + 26 + 26 + 17;
        // !"#$%&'()*+,-.
    } else if (91 <= m && m <= 94) {
        n = m - 90 + 26 * 2 + 17 + 14;
        // [\]^
    } else {
        n = 0;
    }
    return n;
}

void display(char* text) {
    unsigned int i, j, k, m, n, q;

    unsigned char led[4][8] = {{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                               {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                               {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
                               {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}};   // LED初始化

    for (i = 0; k != 99; i++) {
        k = char2bit(text[i]);                               // 译码

        for  (q = 0; q < 9; q++) {
            if (text[i] != 32) {
                while (character[k][1][q] == 0x00) {
                    q++;                                     // 去掉长方形字符两边的空白
                }
            } else {
                q += 2;                                      // 空格字符留位
            }

            for (j = 0; j < 31; j++) {
                led[0][j] = led[0][j + 1];                   // 当前点阵内容向前推一位
            }

            led[3][7] = character[k][1][q];                  // 新加入一列
            if (q >= 8) {
                led[3][7] = character[0][1][0];              // 字间空格
            }

            for (j = 0; j < 8; j++) {
                if (display_flag_a) {                         // 显示字符画
                    write(j + 1, character[88 + (i % 4)][1][j], j + 1, led[1][j], j + 1, led[2][j], j + 1, led[3][j]);
                } else if (display_flag_b) {
                    write(j + 1, character[92 + (i % 6)][1][j], j + 1, led[1][j], j + 1, led[2][j], j + 1, led[3][j]);
                } else {                                      // 正常内容显示
                    write(j + 1, led[0][j], j + 1, led[1][j], j + 1, led[2][j], j + 1, led[3][j]);
                }
            }
            delay_ms(50);
        }
    }

    for (i = 0; i < 32; i++) {
            for (j = 0; j < 31; j++) {
                led[0][j] = led [0][j + 1];
            }
            led[3][7] = 0x00;                                 // 在内容显示完成后用空白将字符串退出显示区域
            for (j = 0; j < 8; j++) {
                if (display_flag_a) {
                    write(j + 1, character[88 + (i % 20) / 5][1][j], j + 1, led[1][j], j + 1, led[2][j], j + 1, led[3][j]);
                } else if (display_flag_b) {
                    write(j + 1, character[92 + (i % 30) / 5][1][j], j + 1, led[1][j], j + 1, led[2][j], j + 1, led[3][j]);
                } else {
                    write(j + 1, led[0][j], j + 1, led[1][j], j + 1, led[2][j], j + 1, led[3][j]);
                }
            }
            delay_ms(50);
        }
}

void led_off() {
    P8OUT &= ~ 0x02;
    P3OUT &= ~ 0x80;
    P7OUT &= ~ 0x10;
    P6OUT &= ~ 0x08;
    P6OUT &= ~ 0x10;
    P3OUT &= ~ 0x20;
}

void set_frequency(int x) {
    if (x == 0) {                                           // 休止符
        TA0CCTL0 &= ~ 0x0011;
    } else {
        TA0CCTL0 |= 0x0010;
    }

    int f[4][7] = {{'C', 'D', 'E', 'F', 'G', 'A', 'B'},
                // {251, 223, 199, 188, 167, 149, 133},
                   {125, 112, 99,  94,  84,  74,  66 },
                   {63,  56,  50,  47,  42,  37,  33 },
                   {31,  28,  25,  23,  21,  19,  17 }};    // 32768个时钟周期每秒
    TA0CCR0 = f[x / 10][x % 10 - 1];

    // 音高柱
    led_off();
    switch (x % 10) {
        case 7:
        case 6:
            P3OUT |= 0x20;
        case 5:
            P6OUT |= 0x10;
        case 4:
            P6OUT |= 0x08;
        case 3:
            P7OUT |= 0x10;
        case 2:
            P3OUT |= 0x80;
        case 1:
            P8OUT |= 0x02;
        default:
            break;
    }
}

void init2() {
    WDTCTL = WDT_MDLY_8;                 // 定时周期为8ms
    SFRIE1 |= WDTIE;                     // 使能WDT中断
    P1DIR |= BIT0;                       // P1.0输出

    TA0CTL = 0x0110;                     // 选择ACLK时钟及增计数模式(32768)
    TA0CCR0 = 32768;                     // CCR0计数
    TA0CCTL0 &= ~ 0x0011;                // 禁止计数器中断
                                         // 初始化LED及蜂鸣器
    P8DIR |= 0x02;                       // L1（P8.1）
    P3DIR |= 0xE0;                       // L2（P3.7），L6（P3.5），蜂鸣器（P3.6）
    P6DIR |= 0x18;                       // L4（P6.3），L5（P6.4）
    P7DIR |= 0x10;                       // L3（P7.4）

    P8OUT &= ~ 0x02;
    P3OUT &= ~ 0xE0;
    P6OUT &= ~ 0x08;

    P1DIR &= ~ 0x0C;                     // 配置中断
    P1REN |= 0x0C;                       // S1（P1.2），S2（P1.3）
    P1OUT |= 0x0C;

    P1IE |= 0x0C;
    P1IES |= 0x0C;
    P1IFG &= ~ 0x0C;

    P2DIR &= ~ 0x48;
    P2REN |= 0x48;                       // S3（P2.3），S4（P2.6）
    P2OUT |= 0x48;

    P2IE |= 0x48;
    P2IES |= 0x48;
    P2IFG &= ~ 0x48;
}

int main(void)
{
    _enable_interrupts();                // 打开全局中断

    init1();                             // 点阵初始化
    init2();                             // 中断初始化

    int i;
    char* text0 = { "Harbin Institute of Technology; Shenzhen" };   // Harbin Institute of Technology, Shenzhen
    char* text1 = { "!\"#$%&'" };                                   // 哈尔滨工业大学
    char* text2 = { "(*)*;+,-.<" };                                 // 规格严格,功夫到家.
    char* text3 = { "1920 @ 2020  [\\]^" };                         // 1920 - 2020  百年校庆

    while (1) {                                                     // 轮播
        for (i = 0; i < 4; i++) {
            switch (i) {
                case 0:
                    display(text0);
                    break;
                case 1:
                    display(text1);
                    break;
                case 2:
                    display(text2);
                    break;
                case 3:
                    display(text3);
                    break;
                default:
                    break;
            }
        }
    }
    return 0;
}


#pragma vector=PORT1_VECTOR
__interrupt void Port_1_Key(void) {
    if (P1IFG & 0x04) {                  // S1中断
        display_flag_a = 1 - display_flag_a;
        display_flag_b = 0;              // 控制字符画 1

        P1IFG &= ~ 0x04;                 // 关中断标志
      //delay_ms(100);
    }
    if (P1IFG & 0x08) {                  // S2中断
        display_flag_b = 1 - display_flag_b;
        display_flag_a = 0;              // 控制字符画 2

        P1IFG &= ~ 0x08;                 // 关中断标志
      //delay_ms(100);
    }
}

#pragma vector=PORT2_VECTOR
__interrupt void Port_2_Key(void) {
    if (P2IFG & 0x08) {                  // S3中断
        flag = 1;                        // 开始播放校歌
        pos = 0;
        P2IFG &= ~ 0x08;                 // 关中断标志
        delay_ms(100);
    }
    if (P2IFG & 0x40) {                  // S4中断
        flag = 0;                        // 停止播放校歌
        led_off();
        TA0CCTL0 &= ~ 0x0010;            // 禁止计数器中断
        P2IFG &= ~ 0x40;                 // 关中断标志
        delay_ms(100);
    }
}

#pragma vector=TIMER0_A0_VECTOR
__interrupt void Timer_A0(void) {        // CCR0中断
    P3OUT ^= 0x40;                       // 蜂鸣器
}

#pragma vector= WDT_VECTOR
__interrupt void watchdog_timer (void) {
    if (speed_ctrl > SPEED) {
        speed_ctrl = 1;

        P1OUT ^= 0x01;                   // 节拍器
        if (flag) {
            if (pos > MAX_NOTE) {
                pos = 0;                 // 播放进度；从头
            }
            set_frequency(song[pos++]);
        }
    }
    speed_ctrl++;
}

